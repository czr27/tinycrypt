
#include <stdio.h>
#include <stdint.h>

void bin2hex(const char *s, uint32_t x[], int len) {
    int i;
    printf ("\n // %s", s);
    for (i=0; i<len; i++) {
      if ((i & 7)==0) putchar('\n');
      printf (" 0x%02x,", x[i]);
    }
    putchar('\n');
}

// The first 722 digits of PI
uint32_t PI[722]=
{0x03, 0x01, 0x04, 0x01, 0x05, 0x09, 0x02, 0x06,
 0x05, 0x03, 0x05, 0x08, 0x09, 0x07, 0x09, 0x03,
 0x02, 0x03, 0x08, 0x04, 0x06, 0x02, 0x06, 0x04,
 0x03, 0x03, 0x08, 0x03, 0x02, 0x07, 0x09, 0x05,
 0x00, 0x02, 0x08, 0x08, 0x04, 0x01, 0x09, 0x07,
 0x01, 0x06, 0x09, 0x03, 0x09, 0x09, 0x03, 0x07,
 0x05, 0x01, 0x00, 0x05, 0x08, 0x02, 0x00, 0x09,
 0x07, 0x04, 0x09, 0x04, 0x04, 0x05, 0x09, 0x02,
 0x03, 0x00, 0x07, 0x08, 0x01, 0x06, 0x04, 0x00,
 0x06, 0x02, 0x08, 0x06, 0x02, 0x00, 0x08, 0x09,
 0x09, 0x08, 0x06, 0x02, 0x08, 0x00, 0x03, 0x04,
 0x08, 0x02, 0x05, 0x03, 0x04, 0x02, 0x01, 0x01,
 0x07, 0x00, 0x06, 0x07, 0x09, 0x08, 0x02, 0x01,
 0x04, 0x08, 0x00, 0x08, 0x06, 0x05, 0x01, 0x03,
 0x02, 0x08, 0x02, 0x03, 0x00, 0x06, 0x06, 0x04,
 0x07, 0x00, 0x09, 0x03, 0x08, 0x04, 0x04, 0x06,
 0x00, 0x09, 0x05, 0x05, 0x00, 0x05, 0x08, 0x02,
 0x02, 0x03, 0x01, 0x07, 0x02, 0x05, 0x03, 0x05,
 0x09, 0x04, 0x00, 0x08, 0x01, 0x02, 0x08, 0x04,
 0x08, 0x01, 0x01, 0x01, 0x07, 0x04, 0x05, 0x00,
 0x02, 0x08, 0x04, 0x01, 0x00, 0x02, 0x07, 0x00,
 0x01, 0x09, 0x03, 0x08, 0x05, 0x02, 0x01, 0x01,
 0x00, 0x05, 0x05, 0x05, 0x09, 0x06, 0x04, 0x04,
 0x06, 0x02, 0x02, 0x09, 0x04, 0x08, 0x09, 0x05,
 0x04, 0x09, 0x03, 0x00, 0x03, 0x08, 0x01, 0x09,
 0x06, 0x04, 0x04, 0x02, 0x08, 0x08, 0x01, 0x00,
 0x09, 0x07, 0x05, 0x06, 0x06, 0x05, 0x09, 0x03,
 0x03, 0x04, 0x04, 0x06, 0x01, 0x02, 0x08, 0x04,
 0x07, 0x05, 0x06, 0x04, 0x08, 0x02, 0x03, 0x03,
 0x07, 0x08, 0x06, 0x07, 0x08, 0x03, 0x01, 0x06,
 0x05, 0x02, 0x07, 0x01, 0x02, 0x00, 0x01, 0x09,
 0x00, 0x09, 0x01, 0x04, 0x05, 0x06, 0x04, 0x08,
 0x05, 0x06, 0x06, 0x09, 0x02, 0x03, 0x04, 0x06,
 0x00, 0x03, 0x04, 0x08, 0x06, 0x01, 0x00, 0x04,
 0x05, 0x04, 0x03, 0x02, 0x06, 0x06, 0x04, 0x08,
 0x02, 0x01, 0x03, 0x03, 0x09, 0x03, 0x06, 0x00,
 0x07, 0x02, 0x06, 0x00, 0x02, 0x04, 0x09, 0x01,
 0x04, 0x01, 0x02, 0x07, 0x03, 0x07, 0x02, 0x04,
 0x05, 0x08, 0x07, 0x00, 0x00, 0x06, 0x06, 0x00,
 0x06, 0x03, 0x01, 0x05, 0x05, 0x08, 0x08, 0x01,
 0x07, 0x04, 0x08, 0x08, 0x01, 0x05, 0x02, 0x00,
 0x09, 0x02, 0x00, 0x09, 0x06, 0x02, 0x08, 0x02,
 0x09, 0x02, 0x05, 0x04, 0x00, 0x09, 0x01, 0x07,
 0x01, 0x05, 0x03, 0x06, 0x04, 0x03, 0x06, 0x07,
 0x08, 0x09, 0x02, 0x05, 0x09, 0x00, 0x03, 0x06,
 0x00, 0x00, 0x01, 0x01, 0x03, 0x03, 0x00, 0x05,
 0x03, 0x00, 0x05, 0x04, 0x08, 0x08, 0x02, 0x00,
 0x04, 0x06, 0x06, 0x05, 0x02, 0x01, 0x03, 0x08,
 0x04, 0x01, 0x04, 0x06, 0x09, 0x05, 0x01, 0x09,
 0x04, 0x01, 0x05, 0x01, 0x01, 0x06, 0x00, 0x09,
 0x04, 0x03, 0x03, 0x00, 0x05, 0x07, 0x02, 0x07,
 0x00, 0x03, 0x06, 0x05, 0x07, 0x05, 0x09, 0x05,
 0x09, 0x01, 0x09, 0x05, 0x03, 0x00, 0x09, 0x02,
 0x01, 0x08, 0x06, 0x01, 0x01, 0x07, 0x03, 0x08,
 0x01, 0x09, 0x03, 0x02, 0x06, 0x01, 0x01, 0x07,
 0x09, 0x03, 0x01, 0x00, 0x05, 0x01, 0x01, 0x08,
 0x05, 0x04, 0x08, 0x00, 0x07, 0x04, 0x04, 0x06,
 0x02, 0x03, 0x07, 0x09, 0x09, 0x06, 0x02, 0x07,
 0x04, 0x09, 0x05, 0x06, 0x07, 0x03, 0x05, 0x01,
 0x08, 0x08, 0x05, 0x07, 0x05, 0x02, 0x07, 0x02,
 0x04, 0x08, 0x09, 0x01, 0x02, 0x02, 0x07, 0x09,
 0x03, 0x08, 0x01, 0x08, 0x03, 0x00, 0x01, 0x01,
 0x09, 0x04, 0x09, 0x01, 0x02, 0x09, 0x08, 0x03,
 0x03, 0x06, 0x07, 0x03, 0x03, 0x06, 0x02, 0x04,
 0x04, 0x00, 0x06, 0x05, 0x06, 0x06, 0x04, 0x03,
 0x00, 0x08, 0x06, 0x00, 0x02, 0x01, 0x03, 0x09,
 0x04, 0x09, 0x04, 0x06, 0x03, 0x09, 0x05, 0x02,
 0x02, 0x04, 0x07, 0x03, 0x07, 0x01, 0x09, 0x00,
 0x07, 0x00, 0x02, 0x01, 0x07, 0x09, 0x08, 0x06,
 0x00, 0x09, 0x04, 0x03, 0x07, 0x00, 0x02, 0x07,
 0x07, 0x00, 0x05, 0x03, 0x09, 0x02, 0x01, 0x07,
 0x01, 0x07, 0x06, 0x02, 0x09, 0x03, 0x01, 0x07,
 0x06, 0x07, 0x05, 0x02, 0x03, 0x08, 0x04, 0x06,
 0x07, 0x04, 0x08, 0x01, 0x08, 0x04, 0x06, 0x07,
 0x06, 0x06, 0x09, 0x04, 0x00, 0x05, 0x01, 0x03,
 0x02, 0x00, 0x00, 0x00, 0x05, 0x06, 0x08, 0x01,
 0x02, 0x07, 0x01, 0x04, 0x05, 0x02, 0x06, 0x03,
 0x05, 0x06, 0x00, 0x08, 0x02, 0x07, 0x07, 0x08,
 0x05, 0x07, 0x07, 0x01, 0x03, 0x04, 0x02, 0x07,
 0x05, 0x07, 0x07, 0x08, 0x09, 0x06, 0x00, 0x09,
 0x01, 0x07, 0x03, 0x06, 0x03, 0x07, 0x01, 0x07,
 0x08, 0x07, 0x02, 0x01, 0x04, 0x06, 0x08, 0x04,
 0x04, 0x00, 0x09, 0x00, 0x01, 0x02, 0x02, 0x04,
 0x09, 0x05, 0x03, 0x04, 0x03, 0x00, 0x01, 0x04,
 0x06, 0x05, 0x04, 0x09, 0x05, 0x08, 0x05, 0x03,
 0x07, 0x01, 0x00, 0x05, 0x00, 0x07, 0x09, 0x02,
 0x02, 0x07, 0x09, 0x06, 0x08, 0x09, 0x02, 0x05,
 0x08, 0x09, 0x02, 0x03, 0x05, 0x04, 0x02, 0x00,
 0x01, 0x09, 0x09, 0x05, 0x06, 0x01, 0x01, 0x02,
 0x01, 0x02, 0x09, 0x00, 0x02, 0x01, 0x09, 0x06,
 0x00, 0x08 };

uint32_t md2_rand(uint32_t n) {
    uint32_t        x, y;
    static uint32_t pos = 0;
    
    x = PI[pos]; pos++;
    y = 10;    
    
    if (n > 10) {
      x = (x * 10) + PI[pos]; pos++;      
      y = 100;
    }
    if (n > 100) {
      x = (x * 10) + PI[pos]; pos++;
      y = 1000;
    }
    if (x < (n * (y / n))) {
      return (x % n);
    }
    return md2_rand(n);
}

int main(void)
{
    uint32_t i, j, t, S[256];
    
    // Initialize s-box
    for (i=0; i<256; i++) {
      S[i] = i;
    }
    // Shuffle the S-box
    for (i=2; i<=256; i++) {
        j = md2_rand(i);
        t = S[j];
        S[j] = S[i-1];
        S[i-1] = t;
    }
    // Output the S-box
    bin2hex("MD2 PI sbox", S, 256); 
    return 0;
}
